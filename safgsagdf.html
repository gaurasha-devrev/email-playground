<!DOCTYPE html>
<html>
<head>
  <style>
    .repeated {
      color: gray;
    }
    .collapsed {
      display: none;
    }
    .toggle-button {
      cursor: pointer;
      color: blue;
    }
  </style>
</head>
<body>
  <div id="email"></div>
  <script>
    function extractTextFromHTML(html) {
      const div = document.createElement("div");
      div.innerHTML = html;
      return div.innerText.split("\n").map(line => line.trim()).filter(line => line);
    }

    function LCS(arr1, arr2) {
      const len1 = arr1.length;
      const len2 = arr2.length;
      const dp = Array(len1 + 1).fill().map(() => Array(len2 + 1).fill(0));
      for (let i = 1; i <= len1; i++) {
        for (let j = 1; j <= len2; j++) {
          if (arr1[i - 1] === arr2[j - 1]) {
            dp[i][j] = dp[i - 1][j - 1] + 1;
          } else {
            dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
          }
        }
      }

      let i = len1, j = len2;
      const lcs = [];
      while (i > 0 && j > 0) {
        if (arr1[i - 1] === arr2[j - 1]) {
          lcs.unshift(arr1[i - 1]);
          i--;
          j--;
        } else if (dp[i - 1][j] > dp[i][j - 1]) {
          i--;
        } else {
          j--;
        }
      }
      return lcs;
    }

    function markRepeatedContent(newEmailHTML, oldEmailHTML) {
      const newEmailTokens = extractTextFromHTML(newEmailHTML);
      const oldEmailTokens = extractTextFromHTML(oldEmailHTML);
      const lcs = LCS(newEmailTokens, oldEmailTokens);

      return newEmailTokens.map(line => {
        if (lcs.includes(line)) {
          return `<span class="repeated">${line}</span>`;
        } else {
          return `<span>${line}</span>`;
        }
      }).join("<br>");
    }

    function renderEmail(newEmailHTML, oldEmailHTML) {
      const emailContainer = document.getElementById("email");
      emailContainer.innerHTML = markRepeatedContent(newEmailHTML, oldEmailHTML);
    }

    const previousEmailHTML = `
    <div>
      <p>Hi John,</p>
      <p>Thank you for your message. I will get back to you by EOD.</p>
      <p>Best regards,</p>
      <p>Alice</p>
    </div>
    `;

    const newEmailHTML = `
    <div>
      <p>Hi Alice,</p>
            <p>Hi John,</p>
      <p>Thank you for your message. I will get back to you by EOD.</p>
      
      <p>Thank you for your quick response.</p>

      <p>Best regards,</p>
      <p>Alice</p>
    </div>
    `;

    renderEmail(newEmailHTML, previousEmailHTML);
  </script>
</body>
</html>
